<div id="<%= dom_id portfolio %>" class="card border-0">
  <div class="card-body px-0">
    <h2 class="card-title mb-4 <%= example ?  "" : "text-center"  %>">
      <%= example ? "Example Portfolio" : portfolio.name %>
    </h2>
    <% if !showDetail %>
      <p class="card-text">
        <%= portfolio.assets.map{ |asset| "#{asset.ticker} (#{asset.desired_weight.to_s}%)"}.join(" | ") %>
      </p>
    <% else %>
      <div class="row my-4">
        <h4 class="text-center">Market Value: <%= number_to_currency(@mv) %></h4>
      </div>
      <div class="row my-4">
        <div class="col-6">
          <h5 class="text-center">Holdings</h5>
          <div class = "col">
            <div class="accordion" id="assetAccordion">
              <% portfolio.assets.each_with_index do |asset, i| %>
                <div class="accordion-item">
                  <h5 class="accordion-header">
                    <button class="acc-btn accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%="#{i}"%>" aria-expanded="true" aria-controls="collapse<%="#{i}"%>" >
                      <span>
                        <%= "#{asset.name} (#{asset.ticker})" %>
                      </span>
                      <strong>
                        <%= number_to_currency(asset.quantity * asset.price) %>
                      </strong>
                    </button>
                  </h5>
                  <div id="collapse<%="#{i}"%>" class="accordion-collapse collapse show" aria-expanded="true">
                    <div class="accordion-body">
                      <div class="row">
                        <span> Quantity: <strong> <%= asset.quantity || 0.0 %> </strong></span>
                      </div>
                      <div class="row">
                        <span> Current Price: <strong><%= number_to_currency(asset.price) %></strong></span>
                      </div>
                      <div class="row">
                        <span> Current Weight: <strong><%= sprintf("%.2f", 100 * asset.quantity * asset.price / @mv) %>% </strong></span>
                      </div>
                      <div class="row">
                        <span> Stray: <strong> <%= sprintf("%.2f", 100 * asset.quantity * asset.price / @mv - asset.desired_weight) %>% </strong></span>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <div class="col-6 justify-content-center">
          <h5 class="text-center">Target Allocation</h5>
          <%= pie_chart(portfolio.assets.map { |asset| [asset.ticker, asset.desired_weight] }, label: "Desired Allocation", height: "500px", suffix: "%", colors: @colors) %>
        </div>
      </div>

      <%= form_with model: portfolio do |form| %>
        <div class="row mt-4 justify-content-center">
          <div class="col-6 text-center">
                <%= form.label "Enter contribution value: $" %>
                <%= form.number_field :pending_contribution, step: 0.01, value: '%.2f' % portfolio.pending_contribution %>
          </div>
        </div>
            
        <div class="row mt-4 justify-content-center">
          <div class="d-grid col-4">
                <%= form.submit "Calculate Transactions", class: 'mb-2 btn btn-success', remote: true %>
          </div>
        </div>
      <% end %>

      <% if @transactions.length() > 0 %>
        <h5 class="text-center mt-4">Rebalance Transactions</h5>
        <table class="table table-striped">
          <thead>
            <tr>
              <th scope="col">Ticker</th>
              <th scope="col">Direction</th>
              <th scope="col">Quantity</th>
              <th scope="col">New Weight</th>
            </tr>
          </thead>
          <tbody>
            <% @transactions.each do |t| %>
              <tr>
                <th scope="row"><%= t["ticker"] %></th>
                <td><%= t["direction"] %></td>
                <td><%= t["quantity"] %></td>
                <td><%= sprintf("%.2f", 100 * t["new_weight"]) %>%</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% end %>
    <% end %>
  </div>
</div>

<style>
.accordion {
    --bs-accordion-active-color: #fff; /* Sets the text color. */
    --bs-accordion-active-bg: #674ea7; /* Sets the background color. */
}
</style>